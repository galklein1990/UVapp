#r "Newtonsoft.Json"

using System.Net;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Primitives;
using Newtonsoft.Json;

public static async Task<IActionResult> Run(HttpRequest req, ILogger log)
{
    log.LogInformation("C# HTTP trigger function processed a request.");

    string uvi = req.Query["uvi"];

    

    string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
    dynamic data = JsonConvert.DeserializeObject(requestBody);
    uvi = uvi ?? data?.uvi;

    log.LogInformation("Function triggered with uvi parameter: " + uvi);

    return uvi != null
        ? (ActionResult)new OkObjectResult(getRecommendation(uvi))
        : new BadRequestObjectResult("Please pass a UVI measurement on the query string or in the request body");
}


private static string getRecommendation(string uvi)
{
    uvi = uvi.ToLower();
    string res = "";

            if (uvi == "none")
                res = "No UV detected";
            else if (uvi == "low")
                res = "UV is low, if you burn easily make sure you wear long sleeves and apply sunscreen preferably 30spf \n dont forget you sunglasses ;)";
            else if (uvi == "medium")
                res = "UV is medium , try covering yourself as much as you can or stay in the shadow at noon , and don't forget to wear sunglasses, apply sunscreen 30spf and wear a hat";
            else if (uvi == "high")
                res = "High UV , must protect your skin and eyes , try staying indoors or in the shadow as much as possible , wear long clothes and keep your sunglasses on and apply 30spf sunscreen or more every two hours!";
            else if (uvi == "veryhigh")
                res = "Very high UV , you need special protection for your eyes and skin , keep your sun exposure to minimum , wear long clothes, a hat and sunglasses , apply high sunscreen every two hours ";

            return res;
}